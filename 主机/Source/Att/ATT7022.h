/*******************************************************************************************************
**------------------------------------------------------------------------------------------------------
** 文件	: 	ATT7022.h			
** 版本	: 	v1.0
**------------------------------------------------------------------------------------------------------
** 描述	:	
		本文件为ATT7022驱动程序
**------------------------------------------------------------------------------------------------------
********************************************************************************************************/
#ifndef __ATT7022_H__
#define __ATT7022_H__

//------------------------------------------------------------------------------------------------
// 校正参数结构体                   
typedef struct  
{
	long   	lHFConst;           	        //高频脉冲常数 	  		0x000080 
	float  	fUKrms[3];             		//A相电压校正	  		1
	float 	fIKrms[3];             		//A相电流校正	  		1
}Revise_t;
//------------------------------------------------------------------------------------------------
// 电能参数结构体                   
typedef struct 
{
	double  		dMU[3];											// 电压参数(A,B,C)
	double   		dMI[3];											// 电流参数(A,B,C)
	double   		dMP[4];											// 有功功率(S,A,B,C)
	double   		dMQ[4];											// 无功功率(S,A,B,C)
	double   		dMS[4];											// 视在功率(S,A,B,C)
	double  		dMPF[4];										// 功率因数(S,A,B,C)
	double  		dMF;											// 电网频率
	unsigned long  	dwMPoEpt[4];									// 正向有功电能
	unsigned long  	dwMQoEpt[4];									// 无功电能
}Energy_t;
// 电能参数滤波结构体                   
typedef struct 
{
	double  		FdMU[3];											// 电压参数(A,B,C)
	double   		FdMI[3];											// 电流参数(A,B,C)
	double   		FdMP[4];											// 有功功率(S,A,B,C)
	double   		FdMQ[4];											// 无功功率(S,A,B,C)
	double   		FdMS[4];											// 视在功率(S,A,B,C)
	double  		FdMPF[4];										// 功率因数(S,A,B,C)
	double  		FdMF;											// 电网频率
	unsigned long  	FdwMPoEpt[4];									// 正向有功电能
	unsigned long  	FdwMQoEpt[4];									// 无功电能
}F_Energy_t;

//------------------------------------------------------------------------------------------------
// //实际测得功率
 #define PowerSum  	s_tEmt.dMP [ItemA]

//------------------------------------------------------------------------------------------------
// 相位宏
#define ItemA   	0x00
#define ItemB   	0x01
#define ItemC   	0x02
#define ItemALL   	0x03

//------------------------------------------------------------------------------------------------
// 电压电流校正参数                      
#define   UKrmsA            (s_tRts.fUKrms[0])/8192.0	      
#define   UKrmsB            (s_tRts.fUKrms[1])/8192.0	      
#define   UKrmsC            (s_tRts.fUKrms[2])/8192.0     
#define   IKrmsA            (s_tRts.fIKrms[0])/4096.0
#define   IKrmsB			(s_tRts.fIKrms[1])/4096.0
#define   IKrmsC            (s_tRts.fIKrms[2])/4096.0

//------------------------------------------------------------------------------------------------
// 高频脉冲常数   功率校正，在负载功率因数为 1，即纯电阻负载时校正                                                             *
#define   HFconst           (s_tRts.lHFConst)   
#define   EC				(3200.0)						//电表常数
#define   KCoefficient      (3102.1081/HFconst/EC)    		//功率转换常数           

//------------------------------------------------------------------------------------------------
// ATT7022 电能参数寄存器                                                            *
#define	VOLTAGE		0x0D	// 三相电压
#define	CURRENT		0x10	// 三相电流
#define	POWERS		0x01	// 三相有功功率
#define	PF			0x14	// 功率因数
#define EP			0x1E	// 三相有功能量(合相CF1)		
#define	QPOWERS		0x05	// 三相无功功率
#define	EQ			0x22	// 三相无功能量(合相CF2)
#define FREQUENCY	0x1C	// 线频率>>13


/*******************************************************************************************************
** 函数: AttGetAllVolue, 获取ATT7022UE内部电能计量值
**------------------------------------------------------------------------------------------------------
** 参数: void
** 返回: void
********************************************************************************************************/
void AttGetAllVolue(void );


/********************************************************************************************************
** 函数: Att7022Init
**------------------------------------------------------------------------------------------------------
** 参数: void
** 返回: void
*******************************************************************************************************/
void Att7022Init(void);

/********************************************************************************************************
** 函数: Appear_data
**------------------------------------------------------------------------------------------------------
** 参数: ID_addr:那个ID,pDtr: 返回的数据区
** 返回: 成功 1 失败 0
*******************************************************************************************************/
int Appear_data(char *pDtr);

/********************************************************************************************************
** 函数: PutAllVolue,输出电能参数至串口
**------------------------------------------------------------------------------------------------------
** 参数: NULL
** 返回: 成功 1 失败 0
*******************************************************************************************************/
int PutAllVolue(void);


/********************************************************************************************************
** 函数:  Appear_XX_data,输出某个电能参数至串口
**------------------------------------------------------------------------------------------------------
** 参数: void
** 返回: void
*******************************************************************************************************/
void Appear_I_data(void);
void Appear_F_data(void);
void Appear_P_data(void);
void Appear_Q_data(void);
void Appear_EP_data(void);
void Appear_EQ_data(void);

long AttGetVolue( unsigned char Value);

/*******************************************************************************************************
** 函数: JudgeSta:判断用电器工作状态
**------------------------------------------------------------------------------------------------------
** 参数: NOLL
** 返回: NOLL 
********************************************************************************************************/
void JudgeSta(void);

/********************************************************************************************************
** 函数: PutAllSta,输出用电器状态至串口
**------------------------------------------------------------------------------------------------------
** 参数: NULL
** 返回: void
*******************************************************************************************************/
void PutAllSta(void);

void PutAllData(void);

void AttFilterAllVolue( void );
#endif
/********************************************************************************************************
**                            End Of File
********************************************************************************************************/
